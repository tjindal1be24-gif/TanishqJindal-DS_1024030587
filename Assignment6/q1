#include <iostream>
using namespace std;

class CNode {
public:
    int data;
    CNode* next;
    CNode(int x) { data = x; next = NULL; }
};

class CircularList {
public:
    CNode* head;
    CircularList() { head = NULL; }

    void insertBeginning(int x) {
        CNode* n = new CNode(x);
        if (!head) {
            head = n;
            n->next = n;
            return;
        }
        CNode* t = head;
        while (t->next != head) t = t->next;
        n->next = head;
        t->next = n;
        head = n;
    }

    void insertEnd(int x) {
        CNode* n = new CNode(x);
        if (!head) {
            head = n;
            n->next = n;
            return;
        }
        CNode* t = head;
        while (t->next != head) t = t->next;
        t->next = n;
        n->next = head;
    }

    void insertAfter(int val, int x) {
        if (!head) return;
        CNode* t = head;
        do {
            if (t->data == val) {
                CNode* n = new CNode(x);
                n->next = t->next;
                t->next = n;
                return;
            }
            t = t->next;
        } while (t != head);
    }

    void insertBefore(int val, int x) {
        if (!head) return;
        if (head->data == val) {
            insertBeginning(x);
            return;
        }
        CNode* t = head;
        do {
            if (t->next->data == val) {
                CNode* n = new CNode(x);
                n->next = t->next;
                t->next = n;
                return;
            }
            t = t->next;
        } while (t != head);
    }

    void deleteValue(int val) {
        if (!head) return;
        if (head->data == val) {
            if (head->next == head) {
                delete head;
                head = NULL;
                return;
            }
            CNode* t = head;
            while (t->next != head) t = t->next;
            CNode* temp = head;
            head = head->next;
            t->next = head;
            delete temp;
            return;
        }
        CNode* t = head;
        do {
            if (t->next->data == val) {
                CNode* temp = t->next;
                t->next = temp->next;
                delete temp;
                return;
            }
            t = t->next;
        } while (t != head);
    }

    void search(int val) {
        if (!head) { cout << "Not Found\n"; return; }
        CNode* t = head;
        int pos = 1;
        do {
            if (t->data == val) { cout << "Found at " << pos << endl; return; }
            t = t->next; pos++;
        } while (t != head);
        cout << "Not Found\n";
    }

    void display() {
        if (!head) { cout << "Empty\n"; return; }
        CNode* t = head;
        do {
            cout << t->data << " ";
            t = t->next;
        } while (t != head);
        cout << endl;
    }
};

class DNode {
public:
    int data;
    DNode *prev, *next;
    DNode(int x) { data = x; prev = next = NULL; }
};

class DoublyList {
public:
    DNode* head;
    DoublyList() { head = NULL; }

    void insertBeginning(int x) {
        DNode* n = new DNode(x);
        if (head) head->prev = n;
        n->next = head;
        head = n;
    }

    void insertEnd(int x) {
        DNode* n = new DNode(x);
        if (!head) { head = n; return; }
        DNode* t = head;
        while (t->next) t = t->next;
        t->next = n;
        n->prev = t;
    }

    void insertAfter(int val, int x) {
        DNode* t = head;
        while (t && t->data != val) t = t->next;
        if (!t) return;
        DNode* n = new DNode(x);
        n->next = t->next;
        if (t->next) t->next->prev = n;
        t->next = n;
        n->prev = t;
    }

    void insertBefore(int val, int x) {
        if (!head) return;
        if (head->data == val) {
            insertBeginning(x);
            return;
        }
        DNode* t = head;
        while (t && t->data != val) t = t->next;
        if (!t) return;
        DNode* n = new DNode(x);
        n->next = t;
        n->prev = t->prev;
        t->prev->next = n;
        t->prev = n;
    }

    void deleteValue(int val) {
        if (!head) return;
        if (head->data == val) {
            DNode* t = head;
            head = head->next;
            if (head) head->prev = NULL;
            delete t;
            return;
        }
        DNode* t = head;
        while (t && t->data != val) t = t->next;
        if (!t) return;
        if (t->prev) t->prev->next = t->next;
        if (t->next) t->next->prev = t->prev;
        delete t;
    }

    void search(int val) {
        DNode* t = head;
        int pos = 1;
        while (t) {
            if (t->data == val) { cout << "Found at " << pos << endl; return; }
            t = t->next; pos++;
        }
        cout << "Not Found\n";
    }

    void display() {
        DNode* t = head;
        while (t) {
            cout << t->data << " ";
            t = t->next;
        }
        cout << endl;
    }
};

int main() {
    CircularList cl;
    DoublyList dl;
    int choice, type, val, x;

    while (true) {
        cout << "\n1 Circular List\n2 Doubly List\n3 Exit\n";
        cin >> type;
        if (type == 3) return 0;

        while (true) {
            cout << "\n1 Insert Beginning\n2 Insert End\n3 Insert Before\n4 Insert After\n5 Delete\n6 Search\n7 Display\n8 Back\n";
            cin >> choice;

            if (choice == 8) break;

            cin >> val;
            if (choice == 3 || choice == 4) cin >> x;

            if (type == 1) {
                if (choice == 1) cl.insertBeginning(val);
                else if (choice == 2) cl.insertEnd(val);
                else if (choice == 3) cl.insertBefore(val, x);
                else if (choice == 4) cl.insertAfter(val, x);
                else if (choice == 5) cl.deleteValue(val);
                else if (choice == 6) cl.search(val);
                else if (choice == 7) cl.display();
            }

            if (type == 2) {
                if (choice == 1) dl.insertBeginning(val);
                else if (choice == 2) dl.insertEnd(val);
                else if (choice == 3) dl.insertBefore(val, x);
                else if (choice == 4) dl.insertAfter(val, x);
                else if (choice == 5) dl.deleteValue(val);
                else if (choice == 6) dl.search(val);
                else if (choice == 7) dl.display();
            }
        }
    }
}
